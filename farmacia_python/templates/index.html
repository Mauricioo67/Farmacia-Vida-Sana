{% extends "base.html" %}

{% block title %}Dashboard - Sistema Farmacia{% endblock %}

{% block extra_css %}
<style>
    .stats-card {
        border-radius: var(--card-radius);
        color: white;
        padding: 20px;
        text-align: center;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
    }

    .module-icon {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 15px;
        background: rgba(255, 255, 255, 0.2);
        border: 2px solid rgba(255, 255, 255, 0.3);
        backdrop-filter: blur(5px);
    }

    .quick-action-btn {
        border-radius: 12px;
        padding: 15px 20px;
        transition: all 0.2s ease;
        border: none;
    }

    .quick-action-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
    }

    .badge-access {
        background: white;
        color: #333;
        font-weight: 600;
        padding: 8px 20px;
        border-radius: 20px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    }
</style>
{% endblock %}

{% block content %}
<!-- Header dashboard -->
<div class="text-center mb-5 pt-3">
    <div class="dashboard-card d-inline-block px-5 py-3 mb-4">
        <h1 class="display-6 fw-bold text-primary mb-0">
            <i class="bi bi-speedometer2 me-2"></i>Panel de Control
        </h1>
    </div>

    <div class="dashboard-card p-4">
        <div class="row align-items-center">
            <div class="col-lg-8 text-start">
                <h4 class="text-primary mb-2">
                    <i class="bi bi-calendar-check me-2"></i>
                    Bienvenido al Sistema de Gestión Farmacéutica
                </h4>
                <p class="text-muted mb-0">
                    <i class="bi bi-database ms-3 me-1"></i>
                    Usuario: <span class="fw-bold">{{ session.get('usuario') }}</span>
                </p>
            </div>
            <div class="col-lg-4 text-end">
                <div class="d-inline-block bg-primary bg-opacity-10 p-3 rounded-3">
                    <i class="bi bi-heart-pulse fs-1 text-primary"></i>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Estadísticas -->
<div class="row g-4 mb-5">
    {% for stat in stats %}
    <div class="col-6 col-md-3">
        <div class="stats-card" style="--stat-gradient: {{ stat.gradient }}; background: var(--stat-gradient);">
            <i class="bi {{ stat.icon }} fs-1 mb-2 d-block"></i>
            <h6 class="mb-1 fw-light">{{ stat.title }}</h6>
            <h2 class="mb-0 fw-bold">{{ stat.value }}</h2>
        </div>
    </div>
    {% endfor %}
</div>

<!-- Módulos del sistema -->
<div class="row g-4 justify-content-center mb-5">
    {% set modulos = [
    ('Productos', url_for('products.index'), 'bi-box-seam', 'linear-gradient(135deg, #38b2ac 0%, #319795 100%)'),
    ('Clientes', url_for('clients.index'), 'bi-people', 'linear-gradient(135deg, #4299e1 0%, #3182ce 100%)'),
    ('Ventas (POS)', url_for('sales.create'), 'bi-cart-plus', 'linear-gradient(135deg, #9f7aea 0%, #805ad5 100%)'),
    ('Historial Ventas', url_for('sales.index'), 'bi-receipt', 'linear-gradient(135deg, #f6ad55 0%, #ed8936 100%)'),
    ] %}

    {% for nombre, url, icon, gradient in modulos %}
    <div class="col-6 col-sm-4 col-lg-3">
        <a href="{{ url }}" class="text-decoration-none">
            <div class="dashboard-card h-100"
                style="--module-gradient: {{ gradient }}; background: var(--module-gradient);">
                <div class="card-body p-4 text-center text-white d-flex flex-column">
                    <div class="module-icon">
                        <i class="bi {{ icon }} fs-1"></i>
                    </div>
                    <h5 class="fw-bold mb-2 flex-grow-1">{{ nombre }}</h5>
                    <div class="mt-3">
                        <span class="badge-access">
                            Acceder <i class="bi bi-arrow-right-short"></i>
                        </span>
                    </div>
                </div>
            </div>
        </a>
    </div>
    {% endfor %}
</div>

<!-- Acciones rápidas y Gráfico -->
<div class="row g-4 mb-5">
    <div class="col-lg-7">
        <div class="dashboard-card p-4 h-100">
            <h5 class="fw-bold text-primary mb-4">
                <i class="bi bi-lightning-charge me-2"></i>Acciones Rápidas
            </h5>
            <div class="row g-3">
                <div class="col-md-6">
                    <a href="{{ url_for('sales.create') }}" class="btn btn-primary quick-action-btn w-100 text-start">
                        <i class="bi bi-cart-plus fs-4 mb-2 d-block"></i>
                        <strong>Nueva Venta</strong>
                        <div class="small mt-1">Registro rápido</div>
                    </a>
                </div>
                <div class="col-md-6">
                    <a href="{{ url_for('products.create') }}"
                        class="btn btn-success quick-action-btn w-100 text-start">
                        <i class="bi bi-plus-circle fs-4 mb-2 d-block"></i>
                        <strong>Nuevo Producto</strong>
                        <div class="small mt-1">Nuevo inventario</div>
                    </a>
                </div>
            </div>
        </div>
    </div>
    <div class="col-lg-5">
        <div class="dashboard-card p-4 h-100">
            <h5 class="fw-bold text-primary mb-3">
                <i class="bi bi-graph-up me-2"></i>Tendencia de Ventas
            </h5>
            <div style="height: 180px;">
                <canvas id="salesChart" data-labels='{{ chart_labels | tojson }}'
                    data-values='{{ chart_values | tojson }}'></canvas>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const cards = document.querySelectorAll('.dashboard-card');
        cards.forEach((card, index) => {
            card.style.animation = `fadeIn 0.5s ease-out forwards ${index * 0.1}s`;
            card.style.opacity = '0';
        });

        // Sales Chart
        const chartElement = document.getElementById('salesChart');
        if (chartElement) {
            const labels = JSON.parse(chartElement.dataset.labels || '[]');
            const values = JSON.parse(chartElement.dataset.values || '[]');
            const ctx = chartElement.getContext('2d');

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Ventas (Bs)',
                        data: values,
                        backgroundColor: 'rgba(102, 126, 234, 0.6)',
                        borderColor: 'rgba(102, 126, 234, 1)',
                        borderWidth: 1,
                        borderRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: { beginAtZero: true }
                    }
                }
            });
        }
    });
</script>
{% endblock %}